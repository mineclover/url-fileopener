
# File Opener 기능 설계 문서

이 문서는 `fileopener://` 커스텀 스킴을 통해 로컬 파일을 여는 기능의 설계 사상과 기술적 구조를 설명합니다.

## 1. 핵심 목표

- **표준화된 URL**: 운영체제나 파일 시스템 구조에 상관없이, 일관된 URL을 사용하여 프로젝트 내의 특정 파일을 열 수 있는 방법을 제공합니다.
- **편의성**: 긴 절대 경로 대신, 짧은 `프로젝트 별칭`과 `상대 경로`를 조합하여 사용자가 파일을 쉽게 식별하고 접근할 수 있도록 합니다.

## 2. 시스템 아키텍처

이 시스템은 URL 스킴, 스킴 핸들러, 설정 관리자 세 가지 주요 컴포넌트로 구성됩니다.

### 2.1. URL 스킴 구조

표준 URL 형식은 다음과 같습니다.

```
fileopener://<프로젝트_별칭>?path=<프로젝트_내_상대경로>
```

- **`fileopener://`**: 시스템에 등록된 커스텀 프로토콜입니다.
- **`<프로젝트_별칭>` (Hostname)**: 열고자 하는 프로젝트를 가리키는 별칭입니다. 이 별칭은 로컬 설정 파일에 정의됩니다.
- **`?path=<상대경로>` (Query Parameter)**: 프로젝트의 루트 디렉토리로부터 대상 파일까지의 상대 경로입니다.

#### 특수 URL

- `fileopener://config`: 설정 파일(`fileopener.json`) 자체를 열기 위한 예약된 URL입니다.

### 2.2. 중앙 설정 파일

- **위치**: `~/.protocol-registry/config/fileopener.json`
- **역할**: 각 컴퓨터 환경에서 `프로젝트_별칭`과 로컬 파일 시스템의 `절대 경로`를 매핑하는 "번역기" 역할을 합니다.
- **구조**: 단순한 Key-Value JSON 객체입니다.
  ```json
  {
    "protocol-registry": "/Users/username/project/protocol-registry",
    "my-app": "/Users/username/dev/my-app"
  }
  ```

### 2.3. 컴포넌트별 역할

- **`open-file-demo.js` (프로토콜 등록자)**
  - `fileopener://` 스킴을 OS에 등록하는 역할을 합니다.
  - 이 스킴이 호출될 때 `file-handler.js`가 실행되도록 설정합니다.

- **`file-handler.js` (스킴 핸들러)**
  - `fileopener://` URL을 인자로 받아 실행됩니다.
  - URL을 파싱하여 `프로젝트_별칭`과 `상대_경로`를 추출합니다.
  - `fileopener.json` 설정 파일을 읽어 `프로젝트_별칭`에 해당하는 `절대_경로`를 조회합니다.
  - 조회된 `절대_경로`와 `상대_경로`를 조합하여 최종 파일 경로를 계산합니다.
  - **(보안)** `?path=../`와 같은 입력을 통한 경로 조작(Directory Traversal) 공격을 방지하기 위해, 최종 계산된 경로가 프로젝트의 기본 경로 내에 포함되는지 검증합니다. 벗어날 경우, 오류를 발생시키고 실행을 중단합니다.
  - OS에 맞는 명령어(`open`, `xdg-open`, `start`)를 사용하여 파일을 엽니다.

- **`config-manager.js` (설정 관리자)**
  - 사용자가 `fileopener.json` 파일을 쉽게 관리할 수 있도록 돕는 CLI 유틸리티입니다.
  - `add`, `remove`, `list` 등의 명령어를 제공하여 프로젝트 별칭을 관리합니다.
